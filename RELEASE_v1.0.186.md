# 🔥 GYM MATCH v1.0.186 リリースノート

**リリース日**: 2025-12-08  
**Build**: 186  
**優先度**: 🔴 緊急（v1.0.185の致命的バグ修正）

---

## 🚨 重要な修正

### v1.0.185 の問題点

v1.0.185 では `is_time_mode == null` の場合のみ種目名から判定していたため、
**`is_time_mode: false` で保存されたデータは「回」表示のまま**でした。

#### Before (v1.0.185)
```dart
bool isTimeMode = set['is_time_mode'] == true;
if (set['is_time_mode'] == null) {
  isTimeMode = _getDefaultTimeMode(setExerciseName);
}
```

**問題**: 
- `is_time_mode: false` の場合、`!= null` なので `_getDefaultTimeMode()` が呼ばれない
- サイドプランク 40秒が「**40回**」と表示される ❌

---

## 🔧 v1.0.186 の修正

### After (v1.0.186)
```dart
bool isTimeMode = set['is_time_mode'] == true;
if (set['is_time_mode'] != true) {
  // null または false の場合、種目名から判定
  isTimeMode = _getDefaultTimeMode(setExerciseName);
}
```

**効果**: 
- `is_time_mode` が `null` **または** `false` の場合、種目名から判定
- サイドプランク 40秒が「**40秒**」と正しく表示される ✅

---

## 📝 修正箇所（3箇所）

### 1. ワークアウトテーブル表示（line 3086-3094）
**セット詳細のreps表示**

| 箇所 | 表示例 |
|------|--------|
| 修正前 | サイドプランク: 「40**回**」❌ |
| 修正後 | サイドプランク: 「40**秒**」✅ |

### 2. テーブルヘッダー表示（line 2903-2910）
**「秒数」vs「回数」のヘッダー切替**

| 箇所 | 表示例 |
|------|--------|
| 修正前 | ヘッダー: 「重さ」「**回数**」❌ |
| 修正後 | ヘッダー: 「重さ」「**秒数**」✅ |

### 3. 今日のトレーニングリスト（line 3410-3421）
**リスト形式の表示**

| 箇所 | 表示例 |
|------|--------|
| 修正前 | リスト: 「サイドプランク: 0kg × 40**回**」❌ |
| 修正後 | リスト: 「サイドプランク: 0kg × 40**秒**」✅ |

---

## ✅ 期待動作

### サイドプランク 40秒のデータパターン

| is_time_mode フィールド | 表示（v1.0.185） | 表示（v1.0.186） | 状態 |
|-------------------------|------------------|------------------|------|
| `true` | 40秒 ✅ | 40秒 ✅ | OK |
| `null` | 40秒 ✅ | 40秒 ✅ | OK |
| **`false`** | **40回 ❌** | **40秒 ✅** | 🔥 **修正** |

### クランチ 40秒のデータパターン

| is_time_mode フィールド | 表示（v1.0.185） | 表示（v1.0.186） | 状態 |
|-------------------------|------------------|------------------|------|
| `true` | 40秒 ✅ | 40秒 ✅ | OK |
| `null` | 40秒 ✅ | 40秒 ✅ | OK（v1.0.185で修正済み） |
| **`false`** | **40回 ❌** | **40秒 ✅** | 🔥 **修正** |

### プランク 60秒のデータパターン

| is_time_mode フィールド | 表示（v1.0.185） | 表示（v1.0.186） | 状態 |
|-------------------------|------------------|------------------|------|
| `true` | 60秒 ✅ | 60秒 ✅ | OK |
| `null` | 60秒 ✅ | 60秒 ✅ | OK（v1.0.185で修正済み） |
| **`false`** | **60回 ❌** | **60秒 ✅** | 🔥 **修正** |

---

## 🔍 ログ確認のポイント

### 修正後のログ出力例
```
📊 表示: サイドプランク - isTimeMode: true, reps: 40, is_time_mode field: false
```

**注目点**: 
- `is_time_mode field: false` でも `isTimeMode: true` になる
- これは種目名（サイドプランク）から判定されたことを示す

### 修正前のログ出力例（v1.0.185）
```
📊 表示: サイドプランク - isTimeMode: false, reps: 40, is_time_mode field: false
```

**問題点**: 
- `is_time_mode field: false` で `isTimeMode: false` になる
- 種目名から判定されず、「40回」と表示される

---

## 📱 検証手順

### TestFlight での確認手順

1. **v1.0.186 を起動**
2. **既存データの確認**
   - サイドプランク 40秒のデータを表示
   - 「**40秒**」と表示されることを確認 ✅
3. **ログ確認**
   ```
   📊 表示: サイドプランク - isTimeMode: true, reps: 40, is_time_mode field: false
   ```
   - `is_time_mode field: false` でも `isTimeMode: true` になることを確認 ✅

### 新規入力での確認手順

1. **クランチを選択**
2. **秒数トグルをON**
3. **40秒と入力**
4. **ホーム画面で「40秒」と表示されることを確認** ✅

---

## 🎯 対象データ

### 影響を受けるデータ
- **`is_time_mode: false` で保存された全ての腹筋データ**
- 特にサイドプランク、クランチ、レッグレイズなど

### 対象種目（全8種）
1. クランチ
2. レッグレイズ
3. プランク
4. サイドプランク
5. アブローラー
6. ハンギングレッグレイズ
7. バイシクルクランチ
8. ケーブルクランチ

---

## 🔧 技術詳細

### 修正ファイル
1. `lib/screens/home_screen.dart` 
   - Line 2903-2910: テーブルヘッダー
   - Line 3086-3094: セット詳細表示
   - Line 3410-3421: 今日のトレーニングリスト
2. `pubspec.yaml` (version 1.0.186+186)

### コード変更の詳細

#### 変更点
```diff
- if (set['is_time_mode'] == null) {
+ if (set['is_time_mode'] != true) {
```

#### 動作原理
1. `is_time_mode == true` の場合 → **秒数モード** ✅
2. `is_time_mode == null` の場合 → **種目名から判定** ✅
3. `is_time_mode == false` の場合 → **種目名から判定** ✅（v1.0.186で修正）

---

## ⚠️ 注意事項

### ユーザーへの影響
- **ポジティブ**: 過去に秒数入力したデータが正しく「秒」表示されます
- **ネガティブ**: なし（全てのケースで正しく動作）

### 今後の入力
- ユーザーが秒数/回数トグルを選択した場合、`is_time_mode` が明示的に保存されます
- 過去データの互換性問題は、v1.0.186 で完全に解決されました ✅

---

## 🚀 次のステップ

1. ✅ GitHub にコミット済み（ローカル）
2. ⏳ GitHub Actions で自動ビルド開始
3. ⏳ TestFlight 配信
4. ✅ ユーザー検証
   - サイドプランク、クランチ、レッグレイズで「秒」表示確認
   - ログで `is_time_mode field: false` でも `isTimeMode: true` を確認

---

## 🔗 関連リンク

- **GitHub リポジトリ**: https://github.com/aka209859-max/gym-tracker-flutter
- **GitHub Actions**: https://github.com/aka209859-max/gym-tracker-flutter/actions
- **App Store**: https://apps.apple.com/jp/app/gym-match/id6755346813

---

## 📞 サポート

問題が発生した場合は、GitHub Issues でご報告ください：
https://github.com/aka209859-max/gym-tracker-flutter/issues

---

## 📊 リリース履歴

- **v1.0.184**: サイドプランクの exercise_name 取得改善
- **v1.0.185**: 全ての腹筋種目で is_time_mode=null データを秒数表示
- **v1.0.186**: 全ての腹筋種目で is_time_mode=false データも秒数表示 ✅

---

**リリース完了** 🎉

**これで全ての腹筋データが正しく秒数表示されます！**
