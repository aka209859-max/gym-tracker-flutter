# GYM MATCH v1.0.190 Release Notes

**リリース日**: 2025-12-09  
**ビルド番号**: 190  
**優先度**: 🔥 高 - ユーザー要望対応

---

## 🎯 主な変更点

### AIメニュー自動反映機能の実装

ユーザーからの要望に応えて、**AIコーチ（GYM MATCH）が生成したトレーニングメニューを、今日のメニューに実際のセットとして自動反映する機能**を実装しました。

#### ✨ 実装した機能

1. **AI生成メニューの自動解析**
   - AIが生成したテキストから種目名、セット数、回数/秒数を自動抽出
   - 例: 「ベンチプレス 3セット × 10-12回」→ 3セット分の実行可能なデータを生成

2. **ユーザー編集可能な重さ設定**
   - 解析後の各セットの重さは **0kg** に設定
   - ユーザーがホーム画面で自由に重さを変更可能
   - 自分に合った重量を後から設定できる

3. **秒数モード対応**
   - プランクなどの時間ベース種目を自動検出
   - `is_time_mode: true` を設定し、「秒」表示を維持（v1.0.186対応）

4. **AIコーチ名を「GYM MATCH」に変更**
   - プロンプトで「あなたは GYM MATCH、AI搭載のパーソナルトレーニングアプリです」と明記

---

## 📊 解析例

### 入力（AIが生成したテキスト）
```
## 胸・腕トレーニング

・ベンチプレス: 3セット × 10-12回
  休憩: 90秒
  ポイント: バーは胸の下部に下ろす

・ダンベルフライ: 3セット × 12-15回
  休憩: 60秒
  ポイント: 肘は軽く曲げる

・プランク: 3セット × 30秒
  休憩: 60秒
  ポイント: 体をまっすぐに保つ
```

### 出力（workout_logsに保存されるデータ）
```json
{
  "sets": [
    {"exercise_name": "ベンチプレス", "reps": 11, "weight": 0.0, "is_time_mode": false},
    {"exercise_name": "ベンチプレス", "reps": 11, "weight": 0.0, "is_time_mode": false},
    {"exercise_name": "ベンチプレス", "reps": 11, "weight": 0.0, "is_time_mode": false},
    {"exercise_name": "ダンベルフライ", "reps": 13, "weight": 0.0, "is_time_mode": false},
    {"exercise_name": "ダンベルフライ", "reps": 13, "weight": 0.0, "is_time_mode": false},
    {"exercise_name": "ダンベルフライ", "reps": 13, "weight": 0.0, "is_time_mode": false},
    {"exercise_name": "プランク", "reps": 30, "weight": 0.0, "is_time_mode": true},
    {"exercise_name": "プランク", "reps": 30, "weight": 0.0, "is_time_mode": true},
    {"exercise_name": "プランク", "reps": 30, "weight": 0.0, "is_time_mode": true}
  ]
}
```

### ホーム画面での表示例
- **ベンチプレス**: 3セット × 11回 × 0kg（← ユーザーが80kgに変更可能）
- **ダンベルフライ**: 3セット × 13回 × 0kg（← ユーザーが20kgに変更可能）
- **プランク**: 3セット × 30秒（← 時間表示、v1.0.186対応）

---

## 🔧 技術的詳細

### 新規追加メソッド: `_parseAIMenuToSets()`

```dart
/// AIメニューテキストから種目セットを解析
/// 
/// 解析ルール:
/// - 「ベンチプレス 3セット × 10-12回」→ 3セット分のデータ作成
/// - 「スクワット 4セット × 8-10回」→ 4セット分のデータ作成
/// - 回数は中央値を採用（10-12回 → 11回）
/// - 重さは0kg（ユーザーが後で設定）
List<Map<String, dynamic>> _parseAIMenuToSets(String menuText) { ... }
```

### 正規表現パターン
- **種目名 + セット数**: `^[・*-]?\s*([^0-9：:(]+?)\s*[：:]?\s*(\d+)\s*セット`
- **回数**: `(\d+)(?:[-~～]\d+)?\s*回`
- **秒数**: `(\d+)\s*秒`

### データ構造の変更点

**変更前（v1.0.189以前）:**
```json
{
  "sets": [],  // 空のまま
  "ai_menu": "（AIが生成した全文テキスト）"
}
```

**変更後（v1.0.190）:**
```json
{
  "sets": [
    {"exercise_name": "...", "reps": 10, "weight": 0.0, "is_time_mode": false},
    ...
  ],
  "ai_menu": "（AIが生成した全文テキスト）"
}
```

---

## 💡 ユーザー体験の改善

### Before (v1.0.189以前)
1. AIコーチでメニュー生成
2. 「今日に追加」をタップ
3. ホーム画面では**空のメニュー**として表示
4. ユーザーが手動で種目を追加する必要があった

### After (v1.0.190)
1. GYM MATCHでメニュー生成
2. 「今日に追加」をタップ
3. ホーム画面に**実際の種目セット**として自動表示
4. **重さだけを変更**すればすぐトレーニング開始可能！

---

## ⚠️ 注意事項

### 既知の制限

1. **AIメニューのフォーマット依存**
   - 「種目名 3セット × 10回」形式を想定
   - 形式が異なる場合は解析できない可能性

2. **複雑な種目名の対応**
   - 「バーベル・ベンチプレス（ナロウグリップ）」などは部分的に解析
   - 将来的に改善予定

3. **重さのデフォルト値**
   - すべて0kgで初期化
   - ユーザーが毎回設定する必要がある
   - 将来的には過去データから推定機能を追加予定

---

## 🧪 テスト項目

### 必須テスト
- [ ] AIメニュー生成（胸・脚・腹筋）
- [ ] 「今日に追加」ボタン押下
- [ ] ホーム画面で種目セットが表示されるか確認
- [ ] 重さを編集できるか確認（0kg → 80kg など）
- [ ] プランクなど時間ベース種目が「秒」表示されるか確認

### 回帰テスト
- [ ] v1.0.186の腹筋秒数表示が正常に動作するか
- [ ] v1.0.187のオフライン保存が正常に動作するか

---

## 🚀 次のステップ

### 今後の改善予定

1. **過去データからの重量推定**
   - 同じ種目の過去データから適切な重量を自動設定

2. **AIメニューのコピー機能改善**
   - ユーザーが「コピーしたがペーストできない」問題の対応
   - クリップボード対応を検討

3. **AI種目ライブラリ**
   - よく生成される種目をデータベース化
   - 解析精度の向上

---

## 📱 動作環境

- **iOS**: 15.0以上
- **Flutter**: 3.35.4
- **Firebase**: Firestore, Auth
- **AI Model**: Google Gemini 2.0 Flash

---

## 🔗 関連リンク

- **App Store**: https://apps.apple.com/jp/app/gym-match/id6755346813
- **GitHub**: https://github.com/aka209859-max/gym-tracker-flutter
- **GitHub Actions**: https://github.com/aka209859-max/gym-tracker-flutter/actions

---

**リリース担当**: AI Assistant  
**コミットID**: bc8aca9  
**タグ**: v1.0.190
