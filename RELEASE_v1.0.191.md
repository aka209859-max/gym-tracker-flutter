# GYM MATCH v1.0.191 Release Notes

**リリース日**: 2025-12-09  
**ビルド番号**: 191  
**優先度**: 🔥 高 - ユーザー要望対応 + AI最適化

---

## 🎯 主な変更点

### 1. ✅ 「[あなたの名前]」表示問題の完全修正

ユーザーからご報告いただいた **「AIコーチの自己紹介で`[あなたの名前]`というプレースホルダーが表示される」** 問題を完全に修正しました。

#### Before（v1.0.190以前）
```
・*ごんにちは！パーソナルトレーナーの[あなたの名前]です。**

ジムに通い始めて間もないあなたのために、胸を効果的に...
```

#### After（v1.0.191）
```
こんにちは！パーソナルトレーナーのGYM MATCHです。

ジムに通い始めて間もないあなたのために、胸を効果的に...
```

---

### 2. 🚀 AI提案の個別最適化（最上級の最適化）

ユーザーから「AIコーチの提案を最上級に最適化する場合は何か調べてくるものはありますか？」とのご質問をいただき、**個別最適化機能を実装**しました。

#### 自動取得するユーザー情報

1. **ユーザープロファイル**
   - 年齢
   - トレーニング経験年数
   - 昨夜の睡眠時間
   - タンパク質摂取量

2. **体組成データ**
   - 最新の体重
   - 最新の体脂肪率

3. **トレーニング実績（直近1週間）**
   - 種目ごとの平均重量を自動計算
   - 例: ベンチプレス 80kg、スクワット 100kg

#### AI提案の改善例

**Before（汎用的な提案）:**
```
【トレーニング部位】
胸

【提案形式】
- ベンチプレス: 3セット × 10-12回
- ダンベルフライ: 3セット × 12-15回
```

**After（個別最適化済み）:**
```
【ユーザー情報】
- 年齢: 30歳
- トレーニング経験: 2年
- 体重: 70kg
- 昨夜の睡眠: 7時間

【最近の実績重量（直近1週間の平均）】
- ベンチプレス: 80kg
- ダンベルフライ: 24kg

上記を踏まえて、以下の最適なメニューを提案します：
- ベンチプレス: 4セット × 8-10回（重量: 85-90kg）
  → 実績80kgから5-10kg増量を推奨
- ダンベルフライ: 3セット × 12回（重量: 26kg）
  → 現在の24kgから少し負荷を上げて筋肥大を促進
```

---

## 🔧 技術的詳細

### 新規実装メソッド: `_getUserContextForAI()`

```dart
/// ユーザーコンテキストを取得（AI最適化用）
Future<Map<String, dynamic>> _getUserContextForAI() async {
  // 1. ユーザープロファイル取得（users collection）
  // 2. 最新の体重・体脂肪率取得（body_measurements collection）
  // 3. 最近のトレーニング実績（workout_logs collection、直近7日）
  // 4. 種目ごとの平均重量を計算
  
  return {
    'age': 30,
    'training_experience_years': 2,
    'sleep_hours': 7.0,
    'weight': 70.0,
    'body_fat': 15.0,
    'recent_weights': {
      'ベンチプレス': 80.0,
      'スクワット': 100.0,
    },
  };
}
```

### プロンプト生成の改善

**変更前:**
```dart
String _buildPrompt(List<String> bodyParts) {
  return 'あなたは GYM MATCH です。メニューを提案してください。';
}
```

**変更後:**
```dart
Future<String> _buildPrompt(List<String> bodyParts) async {
  final userContext = await _getUserContextForAI();
  
  String prompt = '''
あなたはプロのパーソナルトレーナー「GYM MATCH」です。

**重要**: 冒頭の挨拶では必ず「こんにちは！パーソナルトレーナーのGYM MATCHです。」と自己紹介してください。
[あなたの名前]などのプレースホルダーは使わないでください。

【ユーザー情報】
- 年齢: ${userContext['age']}歳
- 体重: ${userContext['weight']}kg
...

【最近の実績重量】
- ベンチプレス: ${recentWeights['ベンチプレス']}kg
...
''';
  
  return prompt;
}
```

---

## 📊 AI提案精度の向上

### データ駆動型の提案

| 項目 | Before | After |
|------|--------|-------|
| 重量提案 | 汎用的（例: 60-80kg） | 個別化（例: 実績80kg → 85-90kg推奨） |
| セット数 | 固定（3-4セット） | 経験年数に応じて調整 |
| 回数 | 汎用的（10-12回） | 目的に応じて最適化 |
| 休憩時間 | 固定（90秒） | 睡眠時間・疲労度を考慮 |

### ユーザーレベル別の提案

**初心者（経験1年未満）:**
- 基本種目中心
- フォーム習得重視
- 軽めの重量で高回数

**中級者（経験1-3年）:**
- 複合種目と単関節種目を組み合わせ
- 漸進的過負荷の原則を適用
- 実績重量+5-10kgを目標

**上級者（経験3年以上）:**
- 高度なテクニック（ドロップセット、スーパーセット）
- 個別の弱点を考慮
- 実績重量+10-15kgへの挑戦

---

## 💡 ユーザー体験の改善

### 1. 自然な自己紹介

- ❌ 「パーソナルトレーナーの[あなたの名前]です」
- ✅ 「パーソナルトレーナーのGYM MATCHです」

### 2. 個別最適化された提案

- ❌ 「ベンチプレス 3セット × 10回」（汎用的）
- ✅ 「ベンチプレス 4セット × 8回（85kg）← 実績80kgから5kg増量」

### 3. データに基づく根拠

- ❌ 「おすすめは〇〇です」
- ✅ 「あなたの実績から、〇〇が最適です」

---

## 🧪 テスト項目

### 必須テスト（TestFlight配信後）

#### 1. 名前表示の確認
- [ ] AIコーチ画面でメニュー生成
- [ ] 「こんにちは！パーソナルトレーナーのGYM MATCHです。」と表示されるか
- [ ] `[あなたの名前]` が表示されないか

#### 2. 個別最適化の確認（データがある場合）
- [ ] 過去にトレーニング記録がある状態でメニュー生成
- [ ] 「【ユーザー情報】」セクションが表示されるか
- [ ] 「【最近の実績重量】」セクションが表示されるか
- [ ] 実績重量を考慮した提案になっているか

#### 3. 個別最適化の確認（データがない場合）
- [ ] 新規ユーザーでメニュー生成
- [ ] エラーが出ないか
- [ ] 汎用的なメニューが提案されるか

### 回帰テスト

- [ ] v1.0.190: AIメニューの自動反映が正常動作するか
- [ ] v1.0.186: 腹筋種目の秒数表示が正常か
- [ ] v1.0.187: オフライン機能が正常か

---

## ⚠️ 既知の制限事項

### 1. ユーザーデータがない場合

新規ユーザーや、まだトレーニング記録がない場合は、汎用的な提案になります。

**対策**: 以下のデータを入力すると、個別最適化が有効になります：
- 体重測定（体組成画面）
- トレーニング記録（1週間分）
- パーソナルファクター設定（年齢、経験年数、睡眠時間など）

### 2. データ取得エラー時

Firestoreへの接続エラーが発生した場合、デフォルト値で提案します。

### 3. 実績重量が0kgの場合

まだ重量を入力していない種目は、実績として表示されません。

---

## 📈 今後の改善予定

### v1.0.192-195で予定

1. **トレーニング目的の設定**
   - 筋肥大/筋力向上/減量/維持
   - 目的に応じた最適な回数・セット数

2. **利用可能時間の考慮**
   - 30分/45分/60分/90分
   - 時間内で完結するメニュー

3. **週のトレーニング頻度**
   - 週3回/週4回/週5回
   - 頻度に応じた分割法の提案

4. **身体的制約の考慮**
   - 腰痛/肩の痛みなど
   - 避けるべき種目の自動除外

5. **得意/苦手部位の考慮**
   - 弱点部位を重点的に
   - 得意部位は維持

---

## 🔗 関連リンク

- **GitHub Actions（ビルド状況）**: https://github.com/aka209859-max/gym-tracker-flutter/actions
- **App Store Connect（TestFlight）**: https://appstoreconnect.apple.com/
- **App Store**: https://apps.apple.com/jp/app/gym-match/id6755346813

---

## 🎯 まとめ

### ✅ 対応完了

1. **「[あなたの名前]」問題の完全修正**
   - AIが「GYM MATCH」として自己紹介
   - プレースホルダーの完全排除

2. **AI提案の個別最適化**
   - ユーザーデータを自動取得・統合
   - 実績重量を考慮した提案
   - 体調・経験年数に応じた調整

3. **データ駆動型AI提案**
   - 過去のトレーニングデータを分析
   - より実践的なメニュー提案
   - 根拠のある重量・回数設定

### 🔄 進行中

- GitHub Actionsでのビルド（約15-20分）
- TestFlightへの配信

### 💡 ユーザーへのお願い

TestFlight配信後、以下をご確認ください：

1. **名前表示の確認**
   - 「GYM MATCH」と正しく表示されるか

2. **個別最適化の確認**
   - ユーザー情報が反映されているか
   - 実績重量を考慮した提案になっているか

3. **提案精度の評価**
   - 以前より実践的な提案になっているか
   - 自分のレベルに合った内容か

---

**v1.0.191リリース完了！🎉**

「[あなたの名前]」問題を修正し、さらにAI提案を個別最適化しました！

次回のAI生成時から、あなた専用の最適なメニューが提案されます。

TestFlight配信後、ぜひお試しください！

---

**リリース日**: 2025-12-09  
**コミット**: e1a12df  
**タグ**: v1.0.191  
**ビルド**: 191
