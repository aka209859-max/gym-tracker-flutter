# 🏋️ GYM MATCH v1.03 完全版ユーザー仕様書

**最終更新日**: 2025-12-08  
**アプリバージョン**: v1.03 (Build 183)  
**開発元**: NEXA  
**プラットフォーム**: iOS 15.0+  
**App Store**: https://apps.apple.com/jp/app/gym-match/id6755346813

---

## 📋 目次

1. [エグゼクティブサマリー](#エグゼクティブサマリー)
2. [v1.03の主要アップデート（Build 149-183）](#v103の主要アップデートbuild-149-183)
3. [10大コア機能](#10大コア機能)
4. [全機能詳細リスト](#全機能詳細リスト)
5. [料金プラン](#料金プラン)
6. [技術情報](#技術情報)
7. [お問い合わせ](#お問い合わせ)

---

## 🎯 エグゼクティブサマリー

**GYM MATCH v1.03** は、トレーニング記録管理・AI コーチング・パートナーマッチング・ジム検索の4つのコア機能を統合した**総合フィットネスアプリ**です。

### 🌟 4つのコア機能
1. **📝 トレーニング記録管理** - 詳細記録・カレンダー・統計・テンプレート
2. **🤖 AI コーチング** - Google Gemini 2.5 Flash による完全自動メニュー生成
3. **👥 パートナーマッチング** - Skill-based Matching（±15% 1RM）
4. **🗺️ ジム検索** - Google Places API・リアルタイム混雑度表示

### ✨ v1.03 の特徴
- ✅ **腹筋トレーニング完全対応**（回数/秒数モード切替）
- ✅ **オフライン記録機能**（ネットワーク不要）
- ✅ **オフ日管理機能**（カレンダーに緑色表示）
- ✅ **日本語完全ローカライズ**（App Store対応）
- ✅ **重要バグ修正多数**（懸垂の体重2重加算、秒数表示等）

---

## 🔄 v1.03の主要アップデート（Build 149-183）

### 📦 Build 149-157: 基盤強化・AI最適化

#### **v1.0.149** - 強制アップデート + Google Maps API最適化
- ✅ 強制アップデート機能実装（最低バージョン管理）
- ✅ Google Maps API コスト最適化（Hive キャッシュ導入）
  - キャッシュ導入で**年間¥48,564削減/1000ユーザー**
  - Place Details キャッシュ（30日間有効）
  - 検索結果キャッシュ（24時間有効）

#### **v1.0.153-156** - お気に入り機能バグ修正
- 🐛 お気に入りボタンの状態管理バグ修正
- 🐛 お気に入り保存時の同期エラー修正
- ✨ UX改善（お気に入り登録時の即座フィードバック）

#### **v1.0.157** - AI アップグレード + Null Safety 修正
- 🤖 **Google Gemini 2.5 Flash** に更新
- 🛡️ Null Safety 修正（アプリクラッシュ防止）
- ⚡ AI応答速度の向上

---

### 💪 Build 158-164: トレーニング記録機能強化

#### **v1.0.158** - 懸垂の体重自動反映 + グラフ機能実装（完全版）
- ✨ **懸垂の自動体重反映機能**
  - 懸垂・チンニング等の体重依存種目で自動的に体重を記録
  - 例: 体重93kg、追加重量10kg → 合計103kgとして記録
- 📊 **グラフ機能完全実装**
  - 体重推移グラフ
  - 部位別トレーニング量グラフ
  - 週間ボリューム推移グラフ

#### **v1.0.159** - 体重記録削除機能
- ✨ 体重記録の個別削除機能追加
- 🗑️ スワイプで削除（確認ダイアログ付き）

#### **v1.0.160** - グラフUI大幅改善
- 🎨 グラフデザインの視認性向上
- 📱 タッチ操作で詳細データ表示
- 🔄 期間切り替え（1週間・1ヶ月・3ヶ月・全期間）

#### **v1.0.161** - 記録系オフライン機能実装
- 📴 **オフライン記録対応**
  - ネットワーク接続なしでトレーニング記録可能
  - オンライン復帰時に自動同期
  - `connectivity_plus` パッケージ統合

#### **v1.0.162** - 休憩タイマーのブラックアウト/データ消失バグの完全修正
- 🐛 **CRITICAL FIX**: 休憩タイマー中の画面ブラックアウトバグ修正
- 🛡️ タイマー実行中のデータ保護強化
- ⏰ タイマー中断時の適切なリカバリー処理

#### **v1.0.163** - オフライン記録機能の動作不具合修正
- 🐛 オフライン時の同期エラー修正
- ✅ オフラインモード判定ロジック改善

#### **v1.0.164** - Firebase Analytics 完全実装
- 📊 **Firebase Analytics 統合**
  - ユーザー行動トラッキング
  - スクリーン遷移分析
  - イベントログ記録
  - パフォーマンスモニタリング

---

### 🎯 Build 165-173: 腹筋機能完全対応

#### **v1.0.165** - 腹筋カテゴリ追加（緊急修正）
- ✨ **腹筋カテゴリ新設**
  - プランク、クランチ、レッグレイズ等
  - 腹筋専用のトレーニング記録UI

#### **v1.0.166** - 体幹カテゴリ削除・腹筋に統一
- 🔄 体幹カテゴリを腹筋カテゴリに統合
- 📝 カテゴリ選択UIの簡素化

#### **v1.0.167** - 腹筋トレーニング記録UI改善
- 🎨 腹筋専用のUI最適化
- ✨ 回数/秒数の切り替えボタン追加

#### **v1.0.168** - 腹筋の秒数表示対応（トレーニング履歴）
- ✨ トレーニング履歴で秒数表示（「30回」→「30秒」）
- 🐛 秒数モードの保存ロジック修正

#### **v1.0.169** - 腹筋の回数/秒数モード完全対応
- ✨ **腹筋種目の回数/秒数モード切替機能**
  - プランク系: デフォルト「秒数」モード
  - クランチ系: デフォルト「回数」モード
  - ユーザーが自由に切り替え可能
- 💾 `is_time_mode` フラグの Firestore 保存

#### **v1.0.170** - ホーム画面の腹筋表示修正
- 🐛 ホーム画面での腹筋秒数表示バグ修正
- ✅ カレンダー下のトレーニング一覧で正しく「秒」表示

#### **v1.0.171** - 腹筋の自重加算バグ修正（CRITICAL）
- 🐛 **CRITICAL FIX**: 腹筋種目で体重が誤って加算されるバグ修正
- ✅ 腹筋は常に「自重」として記録（重量0kg）

#### **v1.0.172** - 秒数表示問題のデバッグログ追加
- 🔍 秒数表示デバッグ出力追加
- 🧪 テスト用ログ記録

#### **v1.0.173** - 腹筋の自重表示 + 強化デバッグログ
- ✨ 腹筋種目で「自重」と明確に表示（例: 「自重 30秒」）
- 🔍 デバッグログ強化（`is_time_mode` 判定追跡）

---

### 🌐 Build 174: 日本語ローカライゼーション

#### **v1.0.174** - 日本語ローカライゼーション対応
- 🌐 **App Store Connect 日本語対応**
  - Xcode プロジェクトに日本語ロケール追加
  - `Info.plist` に `CFBundleLocalizations` 設定
  - App Store 審査で日本語アプリとして認識
- ✅ App Store での日本語表示が可能に

---

### 🐛 Build 175-178: 重要バグ修正 + 新機能

#### **v1.0.175** - 懸垂の体重2重加算バグ修正（根本解決）
- 🐛 **CRITICAL FIX**: 懸垂での体重2重加算バグを完全修正
  - 症状: 93kg → 186kg → 279kg と体重が加算され続ける
  - 原因: 保存済み重量に体重を再度加算
  - 修正: `additional_weight` フィールド使用で根本解決
- ✅ 懸垂・チンニング等で正確な重量記録が可能に

#### **v1.0.176** - ホーム画面の＋ボタンから追加時に秒数モードを引き継ぐ
- ✨ ホーム画面の「＋」ボタンから追加時、前回の秒数モード設定を自動引き継ぎ
  - 例: 前回プランクを30秒で記録 → 次回も秒数モードで開始
- 🔄 `is_time_mode` の自動継承ロジック実装

#### **v1.0.177** - オフラインモードのネットワーク検出を改善
- 🌐 オフライン検出ロジックの精度向上
- ✅ `connectivity_plus` + Firebase 疎通確認の二重チェック
- 🐛 誤ったオンライン判定の修正

#### **v1.0.178** - オフ日機能を実装（カレンダーにグリーン表示）
- ✨ **NEW: オフ日（休息日）機能**
  - カレンダーで「オフ」ボタンをタップして休息日を記録
  - オフ日は**緑色**で「オフ」と表示
  - トレーニング継続の可視化・モチベーション管理
- 🎨 カレンダーマーカーのデザイン改善

---

### 🔧 Build 179-183: ビルドエラー修正（最終調整）

#### **v1.0.179** - 構文エラー修正（CRITICAL）
- 🐛 **CRITICAL FIX**: `home_screen.dart` の構文エラー修正
  - `InkWell` ウィジェットが正しく閉じられていない
  - `Container` に重複した `child` プロパティ
  - `Row` の `children` インデント不正
  - 孤立した `style` パラメータ
- ✅ Build 173-178 の失敗原因を完全解消

#### **v1.0.180** - connectivity_plus API 互換性修正
- 🐛 **CRITICAL FIX**: `connectivity_plus` API 変更対応
  - `connectivity_plus ^6.1.2` は `List<ConnectivityResult>` を返す仕様に変更
  - `ConnectivityResult` → `List<ConnectivityResult>` に型変更
  - 条件判定を `.contains(ConnectivityResult.none)` に修正
- ✅ オフラインモード検出の正常動作を回復

#### **v1.0.181** - 秒数表示の残存バグ修正
- 🐛 ホーム画面「今日のトレーニング」リストでの秒数表示バグ修正
  - 修正箇所: `home_screen.dart` line 3381
  - 修正箇所: `add_workout_screen.dart` line 2286（前回記録表示）
- ✅ `is_time_mode` チェック追加で「30回」→「30秒」に正しく表示

#### **v1.0.182** - テーブル表示の秒数バグ完全修正
- 🐛 **CRITICAL FIX**: セットテーブルヘッダー + 既存データの秒数表示修正
  - **問題**: テーブルヘッダーが固定で「回数」と表示
  - **問題**: v1.0.169以前の古いデータに `is_time_mode` フィールドがない
  - **修正1**: ヘッダーを動的に「秒数」or「回数」に切り替え
  - **修正2**: `_getDefaultTimeMode(exerciseName)` で種目名から自動判定
    - プランク・サイドプランク → 秒数
    - その他の腹筋 → 回数
- ✅ 過去データも正しく「秒」or「回」で表示

#### **v1.0.183** - ビルドエラー修正（欠落関数追加）
- 🐛 **CRITICAL FIX**: `_getDefaultTimeMode` 関数が `home_screen.dart` に未定義
  - v1.0.182 で呼び出しているが関数定義が存在せず
  - `add_workout_screen.dart` から同一ロジックをコピー
  - プランク・サイドプランク: `true`（秒数）
  - その他: `false`（回数）
- ✅ Build 183 でコンパイルエラー完全解消

---

## 🏆 10大コア機能

### 1️⃣ トレーニング記録管理

#### **概要**
詳細なトレーニング記録、カレンダービュー、統計ダッシュボード、テンプレート機能を搭載。

#### **主要機能**
- ✍️ **詳細記録**
  - 種目・重量・回数・セット数・RPE・メモ
  - **NEW**: 腹筋種目の回数/秒数モード切替
  - **NEW**: 自重トレーニング対応（懸垂、腹筋等）
- 🗓️ **カレンダービュー**
  - トレーニング日を視覚的に確認
  - **NEW**: オフ日（休息日）を緑色表示
- 📊 **統計ダッシュボード**
  - 7日間/今月/全期間の総挙上重量
  - 月間ワークアウト日数
  - 部位別トレーニング量グラフ（v1.0.158+）
- 📋 **テンプレート機能**
  - よく行うメニューを保存・ワンタップ適用
- 📥📤 **CSV インポート/エクスポート**
  - 他アプリからのデータ移行
  - バックアップ作成
- 📴 **オフライン記録対応**（v1.0.161+）
  - ネットワーク不要でトレーニング記録可能
  - オンライン復帰時に自動同期

#### **使用シーン**
- **シーン1**: ジムでトレーニング直後に即座に記録
- **シーン2**: 月間の成長を統計グラフで確認
- **シーン3**: プランク30秒 → 秒数モードで正確に記録

---

### 2️⃣ AI トレーニングコーチング

#### **概要**
Google Gemini 2.5 Flash AI を搭載し、部位別・レベル別に最適なトレーニングメニューを自動生成。

#### **主要機能**
- 🤖 **部位別メニュー生成**
  - 胸・背中・脚・肩・腕・腹筋・体幹・有酸素
- 🎯 **レベル別カスタマイズ**
  - 初心者モード: フォーム重視、安全な種目
  - 中級者モード: ボリューム重視、複合種目
  - 上級者モード: 高強度、ドロップセット・スーパーセット
- 📈 **成長予測**（Premium以上）
  - 1RM予測（理論的最大挙上重量）
  - 成長曲線予測
  - 個人要因補正（年齢・経験・睡眠・栄養・飲酒）
- 📊 **週次レポート自動生成**（Premium以上）
  - 週間総挙上重量分析
  - 部位別トレーニング量分析
  - 前週比較・AI改善提案
- 💪 **疲労管理システム**
  - トレーニング量から疲労度を自動計算
  - 部位別疲労度の可視化
  - オーバートレーニング警告

#### **AI使用回数制限**
| プラン | 月間回数 | リワード広告 | 追加パック |
|--------|----------|--------------|------------|
| **無料** | 0回 | 月3回まで | ¥300/5回 |
| **Premium** | 10回 | 利用可能 | ¥300/5回 |
| **Pro** | ∞（無制限） | 利用可能 | ¥300/5回 |

---

### 3️⃣ ジム検索・混雑度表示

#### **概要**
GPS位置情報とGoogle Maps連携で、現在地周辺のジムをリアルタイム混雑度付きで検索・表示。

#### **主要機能**
- 🗺️ **リアルタイム混雑度表示**（5段階）
  - 空いている 🟢 → やや混雑 🟡 → 混雑 🟠 → 非常に混雑 🔴
  - ユーザーレポート（24時間有効）最優先
  - 統計データから推定混雑度算出
- 📍 **ジム詳細情報**
  - 営業時間・定休日・電話番号・住所
  - 設備情報（フリーウェイト・マシン・有酸素・シャワー等）
  - 写真ギャラリー
  - Google Maps 連携（ルート検索ワンタップ）
- ❤️ **お気に入り登録**（Premium以上）
  - よく行くジムをブックマーク
  - **v1.0.153-156**: お気に入りバグ修正完了
- 📊 **混雑度レポート投稿**
  - ユーザーが現在の混雑度を5段階でレポート
  - 投稿で混雑度即座に更新
- ⭐ **レビュー機能**（Premium以上）
  - 5段階評価 + コメント投稿
- 🔍 **高度な検索・フィルター**
  - キーワード検索、エリアフィルター
  - 設備フィルター、営業時間フィルター
- 💰 **コスト最適化**（v1.0.149+）
  - Hive キャッシュで API コスト削減（年間¥48,564/1000ユーザー）

---

### 4️⃣ トレーニングパートナーマッチング（Proプラン限定）

#### **概要**
同じ目標を持つトレーニング仲間をマッチング。3層マッチングアルゴリズムで最適なパートナーを提案。

#### **マッチングアルゴリズム**
1. **Skill-based Matching（±15% 1RM）**
   - BIG3（ベンチプレス・スクワット・デッドリフト）の1RMで ±15% 以内をマッチング
   - 実力差が大きすぎるユーザーは除外
2. **時空間コンテキストマッチング**
   - 同じジムをお気に入り登録
   - 同じ曜日・時間帯（±2時間）に活動
3. **Pro Plan限定可視性**
   - 無料ユーザーはPro会員を検索不可
   - Pro会員は全ユーザーを検索可能（非対称性）

#### **主要機能**
- 👥 **条件検索**
  - 距離・目標・経験レベル・性別・年齢・曜日・時間帯
- 💬 **メッセージング機能**
  - 1対1チャット
  - リアルタイム更新（Firebase Realtime Database）
- 🤝 **フレンドリクエスト**
  - リクエスト送信・受信・承認・拒否

---

### 5️⃣ 体重・体組成管理

#### **主要機能**
- ⚖️ **体重記録**
  - 日々の体重を記録
  - 体脂肪率・除脂肪体重も記録可能
  - **v1.0.159**: 体重記録削除機能追加
- 📊 **体重推移グラフ**（v1.0.158+）
  - 期間切り替え（1週間・1ヶ月・3ヶ月・全期間）
  - タッチ操作で詳細データ表示
  - **v1.0.160**: グラフUI大幅改善
- 🧮 **体組成計算機**
  - BMI計算
  - 体脂肪率推定
  - 除脂肪体重算出
- 📐 **カロリー計算機**
  - TDEE計算（基礎代謝・活動量から1日消費カロリー算出）
  - 目標別推奨カロリー（減量・維持・増量）

---

### 6️⃣ パーソナルレコード（PR）管理

#### **主要機能**
- 🏅 **自動PR更新**
  - トレーニング記録時に最大重量を自動判定・更新
  - **v1.0.175**: 懸垂の体重2重加算バグ修正で正確なPR記録
- 📋 **種目別PR一覧**
  - 全種目のパーソナルベスト表示
  - PR達成日記録
- 🧮 **1RM計算機**
  - 複数公式対応（Epley・Brzycki・Lander等）
  - %1RM逆算
  - 重量推奨（トレーニング目的別）

---

### 7️⃣ 目標設定・達成バッジ

#### **主要機能**
- 🎯 **目標設定**
  - 体重目標・種目別目標・期限管理
  - 達成判定自動化
- 🏆 **達成バッジシステム**
  - 継続バッジ（連続記録日数）
  - ボリュームバッジ（総挙上重量）
  - PR達成バッジ（自己記録更新）
  - 種目別バッジ（特定種目達成）

---

### 8️⃣ 計算ツール（全プラン共通）

#### **主要機能**
- 🧮 **1RM計算機**
  - 実施重量・回数から最大挙上重量を計算
  - 複数公式対応・%1RM逆算
- 📏 **プレート計算機**
  - 目標重量から必要なプレート枚数を自動計算
  - バーベル重量（20kg/15kg）を考慮
- 📐 **体組成計算機**
  - BMI・体脂肪率・除脂肪体重算出
- 📊 **カロリー計算機**
  - TDEE計算・目標別推奨カロリー

---

### 9️⃣ SNSシェア・コミュニティ

#### **主要機能**
- 📤 **トレーニング記録シェア**
  - 画像生成・SNSシェア（Twitter・Instagram・LINE）
  - カスタムデザイン・ハッシュタグ自動付与
- 📸 **スクリーンショット共有**
  - アプリ内で画面キャプチャ・即座にSNS投稿

---

### 🔟 開発者機能・アナリティクス

#### **主要機能**
- 🔧 **開発者メニュー**
  - デバッグログ表示
  - パスワードゲート機能
- 📊 **Firebase Analytics**（v1.0.164+）
  - ユーザー行動トラッキング
  - スクリーン遷移分析
  - イベントログ記録
  - パフォーマンスモニタリング

---

## 📱 全機能詳細リスト

### 🏠 ホーム画面（記録画面）
**画面数**: 15画面  
**サービス数**: 12サービス

#### 画面リスト
1. `home_screen.dart` - メイン記録画面
   - **v1.0.173-183**: 腹筋秒数表示修正完了
   - **v1.0.178**: オフ日機能追加（緑色「オフ」表示）
   - **v1.0.179**: 構文エラー修正（InkWell, Container等）
   - **v1.0.182-183**: テーブルヘッダー動的化 + 既存データ対応
2. `add_workout_screen.dart` - トレーニング記録追加
   - **v1.0.169**: 腹筋の回数/秒数モード切替実装
   - **v1.0.176**: 秒数モード自動引き継ぎ
   - **v1.0.181**: 前回記録表示の秒数バグ修正
3. `add_workout_screen_complete.dart` - 記録完了画面
4. `workout_log_screen.dart` - 記録一覧
5. `workout_detail_screen.dart` - 記録詳細
6. `simple_workout_detail_screen.dart` - シンプル詳細
7. `template_screen.dart` - テンプレート管理
8. `create_template_screen.dart` - テンプレート作成
9. `workout_import_preview_screen.dart` - CSVインポート
10. `workout_memo_list_screen.dart` - ワークアウトメモ
11. `body_measurement_screen.dart` - 体組成記録
    - **v1.0.159**: 体重記録削除機能追加
12. `body_part_tracking_screen.dart` - 部位別追跡
13. `visit_history_screen.dart` - ジム訪問履歴
14. `trainer_records_screen.dart` - トレーナー記録
15. `statistics_dashboard_screen.dart` - 統計ダッシュボード
    - **v1.0.158**: グラフ機能完全実装
    - **v1.0.160**: グラフUI大幅改善

#### サービス
- `workout_service.dart` - トレーニング記録CRUD
- `offline_service.dart` - オフライン記録管理
  - **v1.0.161**: オフライン記録機能実装
  - **v1.0.163**: オフライン同期エラー修正
  - **v1.0.177**: ネットワーク検出改善
  - **v1.0.180**: `connectivity_plus` API対応
- 他10サービス

---

### 🤖 AI機能（コーチング・分析）
**画面数**: 8画面  
**サービス数**: 6サービス

#### 画面リスト
1. `ai_coaching_screen.dart` - AIコーチング
   - **v1.0.157**: Google Gemini 2.5 Flash にアップグレード
2. `growth_prediction_screen.dart` - 成長予測
3. `training_effect_analysis_screen.dart` - 効果分析
4. `weekly_reports_screen.dart` - 週次レポート
5. `fatigue_management_screen.dart` - 疲労管理
6. `personal_factors_screen.dart` - 個人要因設定
7. `ai_addon_purchase_screen.dart` - AI追加パック購入
8. 他1画面

#### AI使用回数制限
| プラン | 月間回数 | リワード広告 | 追加パック |
|--------|----------|--------------|------------|
| **無料** | 0回 | 月3回まで | ¥300/5回 |
| **Premium** | 10回 | 利用可能 | ¥300/5回 |
| **Pro** | ∞（無制限） | 利用可能 | ¥300/5回 |

---

### 🗺️ ジムマップ機能
**画面数**: 12画面  
**サービス数**: 9サービス

#### 画面リスト
1. `map_screen.dart` - Google Mapsマップ
2. `gym_list_screen.dart` - ジム一覧
3. `gym_detail_screen.dart` - ジム詳細
4. `crowd_report_screen.dart` - 混雑度報告
5. `gym_review_screen.dart` - レビュー投稿
6. `favorites_screen.dart` - お気に入り
   - **v1.0.153-156**: お気に入りバグ修正完了
7. `search_screen.dart` - ジム検索
8. 他5画面

#### サービス
- `gym_service.dart` - Google Places API統合
  - **v1.0.149**: Hive キャッシュ導入（年間¥48,564削減/1000ユーザー）
- `gym_search_service.dart` - ジム検索
- 他7サービス

---

### 👥 トレーニングパートナー機能（Proプラン限定）
**画面数**: 10画面  
**サービス数**: 8サービス

#### 画面リスト
1. `partner_screen.dart` - パートナーホーム
2. `partner_search_screen.dart` - パートナー検索
3. `partner_profile_detail_screen.dart` - プロフィール詳細
4. `partner_profile_edit_screen.dart` - プロフィール編集
5. `partner_requests_screen.dart` - フレンドリクエスト
6. `chat_screen.dart` - チャット一覧
7. `chat_detail_screen.dart` - チャット詳細
8. 他3画面

#### マッチングアルゴリズム（3層）
1. **Skill-based Matching** - BIG3の1RMで ±15% 以内
2. **時空間コンテキストマッチング** - 同じジム・曜日・時間帯（±2時間）
3. **Pro Plan限定可視性** - 無料ユーザーはPro会員を検索不可

---

### 🎯 目標・達成管理
**画面数**: 3画面  
**サービス数**: 3サービス

#### 画面リスト
1. `goals_screen.dart` - 目標設定
2. `achievements_screen.dart` - 達成バッジ
3. `personal_records_screen.dart` - パーソナルレコード
   - **v1.0.175**: 懸垂の体重2重加算バグ修正で正確なPR記録

---

### 🧮 計算ツール（全プラン共通）
**画面数**: 2画面  
**サービス数**: 2サービス

#### 画面リスト
1. `calculators_screen.dart` - 1RM計算 + プレート計算（タブ版）
2. `rm_calculator_screen.dart` - 1RM計算（独立版）

#### 計算機能
1. **1RM計算** - Epley・Brzycki・Lander公式
2. **プレート計算機** - 目標重量から必要なプレート枚数を自動計算

---

### 💳 課金・サブスクリプション
**画面数**: 4画面  
**サービス数**: 5サービス

#### 画面リスト
1. `subscription_screen.dart` - プラン管理
2. `ai_addon_purchase_screen.dart` - AI追加パック購入
3. `trial_progress_screen.dart` - トライアル進捗
4. `redeem_invite_code_screen.dart` - 紹介コード入力

#### RevenueCat Product IDs
| Product Type | Product ID | 価格 |
|--------------|------------|------|
| Premium Monthly | `com.nexa.gymmatch.premium.monthly` | ¥500/月 |
| Pro Monthly | `com.nexa.gymmatch.pro.monthly` | ¥980/月 |
| Premium Annual | `com.nexa.gymmatch.premium.annual` | ¥4,800/年 |
| Pro Annual | `com.nexa.gymmatch.pro.annual` | ¥8,000/年 |
| AI追加パック | `com.nexa.gymmatch.ai_pack_5_v2` | ¥300/5回 |
| Lifetime Pro | `com.gymmatch.app.lifetime_pro` | 買い切り（v1.0.111+） |

---

### 📱 広告（AdMob）
**サービス数**: 4サービス

#### 広告タイプ（2種類）
1. **バナー広告**（無料プランのみ）
   - 表示位置: ホーム画面下部
   - Ad Unit ID: `ca-app-pub-2887531479031819/1682429555`
   - サイズ: 320x50（標準バナー）
2. **リワード広告**（全プラン）
   - 目的: 動画視聴で +1 AI使用回数
   - トリガー: 「動画を見て1回分ゲット」ボタン
   - Ad Unit ID: `ca-app-pub-2887531479031819/6163055454`
   - 動画時間: 約30秒

#### app-ads.txt配信
```
google.com, pub-2887531479031819, DIRECT, f08c47fec0942fa0
```
配信URL: https://gym-match-e560d.web.app/app-ads.txt

---

### 🎨 プロフィール・設定
**画面数**: 12画面  
**サービス数**: 8サービス

#### 画面リスト
1. `profile_screen.dart` - プロフィールホーム
2. `profile_edit_screen.dart` - プロフィール編集
3. `auth_screen.dart` - 認証画面
4. `notification_settings_screen.dart` - 通知設定
5. `onboarding_screen.dart` - オンボーディング
6. `campaign_registration_screen.dart` - キャンペーン登録
7. `campaign_sns_share_screen.dart` - SNSシェア
8. `terms_of_service_screen.dart` - 利用規約
9. `tokutei_shoutorihikihou_screen.dart` - 特定商取引法
10. 他2画面

---

### 🔒 開発者・管理者機能
**画面数**: 9画面  
**サービス数**: 4サービス

#### 画面リスト
1. `developer_menu_screen.dart` - 開発者メニュー
2. `password_gate_screen.dart` - パスワードゲート
3. `debug_log_screen.dart` - デバッグログ
   - **v1.0.172-173**: 秒数表示デバッグログ追加
4. `po_login_screen.dart` - PO（プロダクトオーナー）ログイン
5. `po_dashboard_screen.dart` - POダッシュボード
6. 他4画面

#### サービス
- `console_logger.dart` - コンソールログ
- `debug_service.dart` - デバッグ機能
- `analytics_service.dart` - アナリティクス集計
  - **v1.0.164**: Firebase Analytics 完全実装
- `po_service.dart` - プロダクトオーナー管理

---

## 💰 料金プラン

### 📊 プラン比較表

| 機能 | 無料 | Premium | Pro |
|------|------|---------|-----|
| **月額料金** | ¥0 | ¥500/月<br>¥4,800/年 | ¥980/月<br>¥8,000/年 |
| **無料トライアル** | - | 30日間 | 14日間 |
| **トレーニング記録** | ✅ | ✅ | ✅ |
| **腹筋 回数/秒数モード** | ✅ | ✅ | ✅ |
| **オフライン記録** | ✅ | ✅ | ✅ |
| **オフ日管理** | ✅ | ✅ | ✅ |
| **AI 機能** | 🎬 広告視聴で月3回 | ✅ 月10回 | ✅ 無制限（∞） |
| **お気に入り保存** | ⚠️ 制限あり | ✅ 無制限 | ✅ 無制限 |
| **パートナー検索** | ❌ | ❌ | ✅ |
| **メッセージング** | ❌ | ❌ | ✅ |
| **広告表示** | ⚠️ あり | ✅ なし | ✅ なし |

---

### 🆓 無料プラン（¥0 / 永久無料）

#### **利用可能機能**
- ✅ トレーニング記録
- ✅ カレンダービュー
- ✅ 統計ダッシュボード
- ✅ **腹筋 回数/秒数モード**（v1.0.169+）
- ✅ **オフライン記録**（v1.0.161+）
- ✅ **オフ日管理**（v1.0.178+）
- ✅ 計算ツール（RM・プレート）
- ✅ 目標設定・達成バッジ
- ✅ AI 機能（リワード広告視聴で月3回まで）

#### **制限事項**
- ⚠️ **お気に入り保存**: 制限あり
- ⚠️ **AI 機能**: リワード広告視聴必須（月3回まで）
- ⚠️ **広告表示**: バナー広告あり
- ❌ **パートナー検索**: 不可

---

### 💎 Premium プラン

#### **料金体系**
| 期間 | 料金 | 月換算 | 割引率 | 年間節約額 |
|------|------|--------|--------|------------|
| **月額** | ¥500/月 | ¥500/月 | - | - |
| **年額** | ¥4,800/年 | ¥400/月 | **20% OFF** | **¥1,200お得** |

#### **無料トライアル**
- **期間**: 30日間
- **特典**: 全 Premium 機能を無料体験

#### **利用可能機能**
- ✨ **無料プランの全機能**
- 🤖 **AI 機能 月10回**
- ❤️ **お気に入り無制限**
- 📊 **詳細な混雑度統計**
- 🔔 **混雑度アラート通知**
- 📝 **ジムレビュー投稿**
- 🚫 **広告なし**

---

### 🌟 Pro プラン

#### **料金体系**
| 期間 | 料金 | 月換算 | 割引率 | 年間節約額 |
|------|------|--------|--------|------------|
| **月額** | ¥980/月 | ¥980/月 | - | - |
| **年額** | ¥8,000/年 | ¥667/月 | **32% OFF** | **¥3,760お得** |

#### **無料トライアル**
- **期間**: 14日間
- **特典**: 全 Pro 機能を無料体験

#### **利用可能機能**
- ✨ **Premium プランの全機能**
- 🤖 **AI 機能 無制限（∞）**
- 👥 **トレーニングパートナー検索**
- 💬 **メッセージング機能**
- 🤝 **フレンドリクエスト**

---

### 🎁 AI 追加パック（全ユーザー対象）

#### **料金・内容**
- **価格**: **¥300 / 5回**
- **単価**: ¥60/回
- **対象**: 全ユーザー（無料・Premium・Pro 問わず）
- **有効期限**: 今月末まで（月次リセット）
- **Product ID**: `com.nexa.gymmatch.ai_pack_5_v2`

---

### 💎 Lifetime Pro プラン（買い切り）

#### **料金・内容**（v1.0.111+）
- **価格**: 買い切り（App Store Connect で設定）
- **特典**: Pro プランの全機能を永久利用
- **AI使用回数**: 無制限（∞）
- **Product ID**: `com.gymmatch.app.lifetime_pro`
- **UI**: ゴールドグラデーションバッジ + 星アイコン

---

## 💻 技術情報

### **フロントエンド**
| カテゴリ | 技術 | バージョン |
|----------|------|------------|
| **開発言語** | Dart | 3.5.0+ |
| **フレームワーク** | Flutter | 3.35.4 |
| **状態管理** | Provider | 6.1.5 |

### **バックエンド・データベース**
| カテゴリ | 技術 | 用途 |
|----------|------|------|
| **データベース** | Firebase Firestore | メインデータストア（22コレクション）|
| **認証** | Firebase Authentication | 匿名ログイン |
| **ストレージ** | Firebase Storage | 画像保存 |
| **ローカルDB** | Hive | オフラインキャッシュ（v1.0.149+） |
| **分析** | Firebase Analytics | ユーザー行動トラッキング（v1.0.164+） |

### **外部API連携**
| サービス | 用途 | 詳細 |
|----------|------|------|
| **Google Places API** | ジム検索 | 全国のジム情報取得 + Hive キャッシュ（v1.0.149+） |
| **Google Maps API** | 地図表示 | ルート検索 |
| **Google Gemini 2.5 Flash** | AI コーチング | メニュー生成・成長予測（v1.0.157+） |
| **RevenueCat** | iOS 課金管理 | サブスクリプション |
| **Google AdMob** | 広告配信 | バナー・リワード広告 |
| **connectivity_plus** | ネットワーク検出 | オフライン判定（v1.0.161+, ^6.1.2対応 v1.0.180） |

### **Firestore データ構造（22コレクション）**
```
gyms/                    # ジム情報
users/                   # ユーザープロファイル
workout_logs/            # トレーニング記録（is_time_mode フィールド追加 v1.0.169）
personal_records/        # パーソナルレコード
weekly_reports/          # 週次レポート
goals/                   # 目標
achievements/            # 達成バッジ
crowd_reports/           # 混雑度レポート
reviews/                 # ジムレビュー
favorites/               # お気に入り
training_partners/       # トレーニングパートナー
chat_rooms/              # チャットルーム
chat_messages/           # チャットメッセージ
friend_requests/         # フレンドリクエスト
rest_days/               # オフ日（v1.0.178+）
... (他7コレクション)
```

---

## 🎯 v1.03 の技術的ハイライト

### 1️⃣ 腹筋トレーニング完全対応（v1.0.165-183）

#### **実装内容**
- ✅ 腹筋カテゴリ新設（v1.0.165）
- ✅ 回数/秒数モード切替機能（v1.0.169）
- ✅ `is_time_mode` フィールドのFirestore保存
- ✅ ホーム画面での秒数表示対応（v1.0.170, 181, 182）
- ✅ テーブルヘッダー動的化（v1.0.182）
- ✅ 既存データの自動判定ロジック（v1.0.182-183）

#### **技術的チャレンジ**
- **課題**: v1.0.169以前の古いデータに `is_time_mode` フィールドがない
- **解決**: `_getDefaultTimeMode(exerciseName)` 関数で種目名から自動判定
  - プランク・サイドプランク → 秒数モード
  - その他の腹筋 → 回数モード

---

### 2️⃣ 懸垂の体重2重加算バグ修正（v1.0.158, 175）

#### **問題の詳細**
- **症状**: 懸垂の重量が93kg → 186kg → 279kg と加算され続ける
- **原因**: 保存済み重量（体重含む）に再度体重を加算していた
- **影響**: パーソナルレコード（PR）が不正確になる

#### **修正内容**（v1.0.175）
- ✅ `additional_weight` フィールドを新設
  - 懸垂の「追加重量」のみを記録（体重は除く）
  - 例: 体重93kg、追加重量10kg → `additional_weight: 10`
- ✅ 表示時のみ体重を加算（`93 + 10 = 103kg`）
- ✅ 保存時は追加重量のみを保存（`10kg`）

---

### 3️⃣ オフライン記録機能（v1.0.161-163, 177, 180）

#### **実装内容**
- ✅ `connectivity_plus` パッケージ統合（v1.0.161）
- ✅ オフライン時の Hive ローカルストレージ保存
- ✅ オンライン復帰時の自動同期
- ✅ ネットワーク検出ロジック改善（v1.0.177）
  - `connectivity_plus` + Firebase 疎通確認の二重チェック
- ✅ `connectivity_plus` API 変更対応（v1.0.180）
  - `ConnectivityResult` → `List<ConnectivityResult>` 型変更
  - 複数ネットワークインターフェース対応

---

### 4️⃣ コスト最適化（v1.0.149, 112）

#### **Google Maps API コスト削減**
- ✅ Hive 永続キャッシュ導入
  - 検索結果キャッシュ: 24時間有効
  - Place Details キャッシュ: 30日間有効（Google ToS 準拠）
- ✅ フィールドマスキング実装
  - 写真フィールドをオプション化（Contact Data: $3.00/1k → Basic: $0.017/1k）
- ✅ **コスト削減効果**
  - 月間: ¥4,047/1000ユーザー（~53% 削減）
  - 年間: ¥48,564/1000ユーザー
  - 10万ユーザー時: ¥4.86M/年 削減

---

### 5️⃣ Firebase Analytics 完全実装（v1.0.164）

#### **実装内容**
- ✅ ユーザー行動トラッキング
- ✅ スクリーン遷移分析
- ✅ イベントログ記録
- ✅ パフォーマンスモニタリング
- ✅ カスタムイベント定義
  - `workout_recorded` - トレーニング記録
  - `ai_coaching_used` - AI機能使用
  - `gym_searched` - ジム検索
  - `partner_matched` - パートナーマッチング

---

## 🔒 セキュリティ・プライバシー

### **データ保護**
- 🔐 Firebase Authentication（匿名認証）
- 🔐 HTTPS通信（暗号化）
- 🔐 Firestore Security Rules（ユーザーデータ保護）
- 🔐 RevenueCat（課金情報の安全な管理）

### **プライバシーポリシー**
- 📄 利用規約: https://gym-match-e560d.web.app/terms.html
- 📄 プライバシーポリシー: https://gym-match-e560d.web.app/privacy.html
- 📄 特定商取引法表記: アプリ内設定から閲覧可能

---

## 📞 お問い合わせ

**開発元**: NEXA  
**アプリ名**: GYM MATCH  
**バージョン**: v1.03 (Build 183)  
**App Store**: https://apps.apple.com/jp/app/gym-match/id6755346813  
**GitHub**: https://github.com/aka209859-max/gym-tracker-flutter  
**お問い合わせ**: アプリ内「設定」→「お問い合わせ」  
**メール**: aka209859@gmail.com  
**電話**: +81-70-3770-4770

---

## 🎉 今後の展開

### **短期（3ヶ月）**
- ✅ iOS App Store リリース（完了）
- ✅ AdMob 広告配信開始（完了）
- 🔄 マーケティング開始（SNS・ブログ等）

### **中期（6ヶ月）**
- 📱 プッシュ通知実装
- 📊 データバックアップ・復元機能
- 🎥 動画フォームチェック機能（予定）
- 🍽️ 栄養管理機能（カロリー・マクロ栄養素トラッキング）

### **長期（1年）**
- 🤖 Android版リリース
- 🌍 多言語対応（英語・中国語・韓国語）
- ⌚ Apple Watch 対応
- 🏃 ウェアラブルデバイス連携
- 🏆 大会・コンペティション機能

---

**© 2025 NEXA. All Rights Reserved.**
